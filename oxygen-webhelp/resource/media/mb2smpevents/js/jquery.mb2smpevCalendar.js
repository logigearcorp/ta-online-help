/**
 * @package		Mb2 Simple Events
 * @version		1.1.1
 * @author		Mariusz Boloz (http://mb2extensions.com)
 * @copyright	Copyright (C) 2016 Mariusz Boloz (http://mb2extensions.com). All rights reserved
 * @license		Commercial (http://codecanyon.net/licenses/regular)
**/
!function(a,t){"use strict";a.fn.mb2smpevCalendar=function(t){var e=a.extend({},a.fn.mb2smpevCalendarDefaults(),t);return e=a.extend({},e),this.each(function(){function t(){var t=parseInt(F.data("initYear")),e=parseInt(F.data("initMonth"))-1,d=new Date(t,e,1,0,0,0,0);F.data("initDate",d),F.data("maxDate",d),F.data("minDate",d);var o=a('<div class="mb2smpev-calendar-inner"></div>');i(F,o),o=n(F,o,d.getFullYear(),d.getMonth());var r=a('<div class="mb2smpev-calendar" id="'+F.attr("id")+'2"></div>');r.append(o),F.append(r);var s=F.data("jsonData");!1!==s&&c(F,d.getFullYear(),d.getMonth())}function n(a,t,e,n){var i=new Date(e,n,1,0,0,0,0);return a.data("currDate",i),t.empty(),t=d(a,t,e,n),t=r(a,t),t=s(a,t,e,n),c(a,e,n),t}function i(t,i){e.jumpTo===!0&&a("body").on("click",".mb2smpev-jumpto"+t.data("id"),function(e){e.preventDefault();var d=Number(a("#mb2smpev_jumptoyear"+t.data("id")).val()),r=Number(a("#mb2smpev_jumptomonth"+t.data("id")).val());n(t,i,d,r),o()})}function d(t,i,d,r){var s=t.data("navIcons"),v=a(""!=e.prevHtml?""+e.prevHtml:'<span class="glyphicon glyphicon-chevron-left"></span>'),p=a(""!=e.nextHtml?""+e.nextHtml:'<span class="glyphicon glyphicon-chevron-right"></span>');"object"==typeof s&&("prev"in s&&v.html(s.prev),"next"in s&&p.html(s.next));var c=t.data("showPrevious");("number"==typeof c||c===!1)&&(c=k(t.data("showPrevious"),!0));var l=a('<div class="calendar-month-navigation"></div>');if(l.attr("id",t.attr("id")+"_nav-prev"),l.data("navigation","prev"),c!==!1){var m=r-1,u=d;-1==m&&(u-=1,m=11),l.data("to",{year:u,month:m+1}),l.append(v),"function"==typeof t.data("actionNavFunction")&&l.click(t.data("actionNavFunction")),l.click(function(a){n(t,i,u,m),o()})}var f=t.data("showNext");("number"==typeof f||f===!1)&&(f=k(t.data("showNext"),!1));var h=a('<div class="calendar-month-navigation"></div>');if(h.attr("id",t.attr("id")+"_nav-next"),h.data("navigation","next"),f!==!1){var y=r+1,b=d;12==y&&(b+=1,y=0),h.data("to",{year:b,month:y+1}),h.append(p),"function"==typeof t.data("actionNavFunction")&&h.click(t.data("actionNavFunction")),h.click(function(a){n(t,i,b,y),o()})}var _=e.monthLabels,g=a('<div class="month-prev"></div>').append(l),w=a('<div class="month-next"></div>').append(h),D=a("<span>"+_[r]+" "+d+"</span>");D.click(function(){var a=t.data("initDate");n(t,i,a.getFullYear(),a.getMonth())});var x=a('<div id="'+t.attr("id")+'_month" class="month" data-month="'+Math.ceil(r+1)+'" data-year="'+d+'"></div>'),j=""!=e.calendarIcon?a(""+e.calendarIcon):"";x.append(j),x.append(D);var F=a('<div class="calendar-month-header mb2smpev-clr"></div>');return F.append(g,x,w),i.append(F),i}function o(){a("."+F.attr("id")+"_event-item").remove()}function r(t,n){if(t.data("showDays")===!0){var i=t.data("weekStartsOn"),d=e.dayLabels;if(0===i){var o=a.extend([],d),r=new Array(o.pop());d=r.concat(o)}var s=a('<div class="calendar-dow-header mb2smpev-clr"></div>');a(d).each(function(a,t){s.append("<div>"+t+"</div>")}),n.append(s)}return n}function s(t,e,n,i){var d=(t.data("ajaxSettings"),x(n,i)),o=D(n,i),r=w(n,i,1),s=w(n,i,o),v=1,p=t.data("weekStartsOn");0===p&&(6==s&&d++,6!=r||0!=s&&1!=s&&5!=s||d--,r++,7==r&&(r=0));for(var c=a('<div class="calendar-days mb2smpev-clr"></div>'),l=0;d>l;l++){for(var m=a('<div class="calendar-dow mb2smpev-clr"></div>'),u=0;7>u;u++){if(r>u||v>o)m.append('<div class="empty-day"></div>');else{var f=t.attr("id")+"_"+g(n,i,v),h=f+"_day",y=a('<div id="'+h+'" class="day" >'+v+"</div>");y.data("day",v),_(n,i,v)&&y.addClass("today");var b=a('<div id="'+f+'"></div>');b.append(y),b.data("date",g(n,i,v)),b.data("hasEvent",!1),"function"==typeof t.data("actionFunction")&&(b.addClass("dow-clickable"),b.click(function(){t.data("selectedDate",a(this).data("date"))}),b.click(t.data("actionFunction"))),m.append(b),v++}6==u&&(r=0)}c.append(m),e.append(c)}return e}function v(){if(e.modal!==!0){var t=a('<div class="mb2smpev-events-container" id="'+F.attr("id")+'_events_container"></div>'),n=a('<div class="mb2smpev-events-container2" id="'+F.attr("id")+'_events_container2"></div>');a("#"+F.attr("id")).append(t),a("#"+F.attr("id")+" .mb2smpev-events-container").append(n)}}function p(t,n,i,d,o,r,s,v,p){var c=a("#"+F.attr("id")+"_month").data("month"),l=a("#"+F.attr("id")+"_month").data("year"),m=a("#"+F.attr("id")).data("id"),u=a('<div class="mb2smpev-event-item mb2smpev-event-item-'+m+" "+F.attr("id")+"_event-item "+F.attr("id")+"_event-item_"+s+" "+d+'" id="'+t+'_modal"></div>'),f=a(i);if(o==c&&r==l){if(e.modal===!0){var h=""!=e.modalClose?e.modalClose:"&times;",y=a('<a class="mb2smpev-popup-close" href="#"  data-id="'+t+'_modal">'+h+"</a>"),_=a('<h3 class="mb2smpev-popup-title" id="'+t+'_modal_title">'+n+"</h3>"),g=a('<div class="mb2smpev-popup-content"></div>');g.append(_),g.append(y),g.append(f);var w=a('<div class="mb2smpev-popup-inner"></div>');w.append(g);var u=a('<div class="mb2smpev-popup '+F.attr("id")+"_event-item mb2smpev-event-item-"+m+" "+d+" mb2smpev-elayout"+v+" mb2smpev-thumbc"+p+'" id="'+t+'_modal"></div>');u.append(w)}else u.append(f);return u.data("dateId",t),u.attr("dateId",t),u}b()}function c(a,t,e){var n=a.data("jsonData"),i=a.data("ajaxSettings");return a.data("events",!1),!1!==n?l(a):!1!==i?m(a,t,e):!0}function l(a){var t=a.data("jsonData");return a.data("events",t),h(a,"json"),!0}function m(t,e,n){var i=t.data("ajaxSettings");if("object"!=typeof i||"undefined"==typeof i.url)return alert("Invalid calendar event settings"),!1;var d={year:e,month:n+1};return a.ajax({type:"GET",url:i.url,data:d,traditional:!0,beforeSend:function(){i.onBeforeAjax.call(),o()},dataType:"json"}).done(function(e){var n=[];a.each(e,function(a,t){n.push(e[a])}),t.data("events",n),h(t,"ajax"),i.onAfterAjax.call(),y(250),f(),b()}),!0}function u(){e.modal!==!0&&a("body").on("click",".mb2smpev-event-link",function(t){t.preventDefault();var e=a(this).data("id"),n=a("."+a(this).data("cid")+"_event-item");n.fadeOut(150),setTimeout(function(){a("."+e).fadeIn(150)},150),setTimeout(function(){y(250)},300)})}function f(){e.modal===!0&&("tobottom"===e.modalAnim&&a("."+F.attr("id")+"_event-item").children().css({top:-200,opacity:0}),a("body").on("click",".mb2smpev-popup-link",function(t){t.preventDefault();var n=a(this).data("id");"tobottom"===e.modalAnim?(a("#"+n+" > div").stop().animate({top:0,opacity:1},250),a("#"+n).fadeIn(250)):a("#"+n).fadeIn(250)}),a("body").on("click",".mb2smpev-popup-close",function(t){t.preventDefault();var n=a(this).data("id");"tobottom"===e.modalAnim?(a("#"+n+" > div").stop().animate({top:"-200",opacity:0},250),a("#"+n).fadeOut(250)):a("#"+n).fadeOut(250)}))}function h(t,n){var i=(t.data("jsonData"),t.data("ajaxSettings"),t.data("events"));i!==!1&&a(i).each(function(n,i){var d=t.attr("id")+"_"+i.date,o=a("#"+d),r=a("#"+d+"_day"),s=i.date.split("-")[1],v=i.date.split("-")[0],c=i.date.split("-")[2];if(e.modal===!0?r.wrap('<a href="#'+d+'_modal" class="mb2smpev-popup-link" data-id="'+d+'_modal"></a>'):r.wrap('<a href="#" class="mb2smpev-event-link" data-cid="'+t.attr("id")+'" data-id="'+t.attr("id")+"_event-item_"+c+'"></a>'),o.data("hasEvent",!0),"undefined"!=typeof i.titles&&e.titleTooltip===!0&&"undefined"!=typeof a.fn.tooltipsy){var l='<span class="'+d+'_ttip" style="display:none;"></span>';o.append(l);var m,u="";for(m=0;m<i.titles.length;m++)u+='<span class="ttip-event-title">'+i.titles[m]+"</span>";a("."+d+"_ttip").html(u),o.tooltipsy({content:a("."+d+"_ttip").html(),className:"mb2smpev-ttip",offset:[0,-20],delay:350,alignTo:"cursor"})}if("undefined"!=typeof i.type&&o.addClass(i.type),"undefined"==typeof i.classname?o.addClass("event"):(o.addClass("event-styled"),r.addClass(i.classname)),"undefined"!=typeof i.body){var f=p(d,i.title,i.body,i.type,s,v,c,e.eLayout,e.thumbc);e.modal===!0?a("body").append(f):a("#"+t.attr("id")+" .mb2smpev-events-container2").append(f)}})}function y(t){if(e.modal!==!0){var n=a("#"+F.attr("id")+"_events_container"),i=a("#"+F.attr("id")+"_events_container2");a("."+F.attr("id")+"_event-item");a("#"+F.attr("id")).imagesLoaded(function(){i.height()>0?n.stop().animate({height:i.height()},t):n.css({height:0})})}}function b(){if(e.modal!==!0){var t=a('<div class="mb2smpev-no-events">'+e.no_events_msg+"</div>");a("#"+F.attr("id")).find(".mb2smpev-no-events")[0]||a("#"+F.attr("id")+"_events_container2").append(t),a("#"+F.attr("id")).find(".mb2smpev-event-item")[0]&&a("#"+F.attr("id")).find(".mb2smpev-no-events").remove()}}function _(a,t,e){var n=new Date,i=new Date(a,t,e);return i.toDateString()==n.toDateString()}function g(a,t,e){var n=10>e?"0"+e:e,i=t+1,i=10>i?"0"+i:i;return a+"-"+i+"-"+n}function w(a,t,e){var n=new Date(a,t,e,0,0,0,0),i=n.getDay();return 0==i?i=6:i--,i}function D(a,t){for(var e=28;j(a,t+1,e+1);)e++;return e}function x(a,t){var e=D(a,t),n=w(a,t,1),i=w(a,t,e),d=e,o=n-i;return o>0&&(d+=o),Math.ceil(d/7)}function j(a,t,e){return t>0&&13>t&&a>0&&32768>a&&e>0&&e<=new Date(a,t,0).getDate()}function k(a,t){a===!1&&(a=0);var e,n=F.data("currDate"),i=F.data("initDate");if(e=12*(i.getFullYear()-n.getFullYear()),e-=n.getMonth()+1,e+=i.getMonth(),t===!0){if(e<parseInt(a)-1)return!0}else if(e>=0-parseInt(a))return!0;return!1}var F=a(this);F.attr("id","mb2smpev-calendar_"+Math.floor(99999*Math.random()).toString(36)),F.data("initYear",e.year),F.data("initMonth",e.month),F.data("weekStartsOn",e.weekstartson),F.data("navIcons",e.nav_icon),F.data("showDays",e.show_days),F.data("showPrevious",e.show_previous),F.data("showNext",e.show_next),F.data("jsonData",e.data),F.data("ajaxSettings",e.ajax),F.data("actionFunction",e.action),F.data("actionNavFunction",e.action_nav),t(),v(),u(),a(window).resize(function(){y(0)})}),this},a.fn.mb2smpevCalendarDefaults=function(){var a=new Date,t=a.getFullYear(),e=a.getMonth()+1,n={language:!1,year:t,month:e,show_previous:!0,show_next:!0,show_days:!0,weekstartson:1,nav_icon:!1,data:!1,ajax:!1,action:!1,action_nav:!1,modal:!1,modalAnim:"tobottom",modalClose:"",prevHtml:"",nextHtml:"",calendarIcon:"",jumpTo:!1,overlayBg:!0,overlayBgImg:"",no_events_msg:"No events",titleTooltip:!1,monthLabels:["January","February","March","April","May","June","July","August","September","October","November","December"],dayLabels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]};return n}}(jQuery,window);